# Welcome to Serverless!
#
# For full config options, check the docs:
#    docs.serverless.com

service: template

frameworkVersion: ">=1.28.0 <2.0.0"

provider:
  name: aws
  runtime: python3.7
  timeout: 5
  # memorySize: 2048
  stage: ${opt:stage, self:custom.defaults.stage}
  region: us-west-2

  apiKeys:
    - ${self:service}-${self:provider.stage}

plugins:
  - serverless-plugin-scripts
  - serverless-domain-manager
  - serverless-pseudo-parameters
  - serverless-offline

custom:
  project: demo
  name: ${self:service}-${self:provider.stage}

  defaults:
      stage: local
      region: us-west-2

  basePath:
      prod: ${self:service}
      default: ${self:provider.stage}-${self:service}

  # plugin settings
  # serverless-domain-manager
  customDomain:
    endpointType: regional
    # domainName: ${self:custom.project}.api.bagsprincess.com
    domainName: ${self:custom.project}.api.kanalfred.com
    stage: ${self:provider.stage}
    basePath: ${self:custom.basePath.${self:provider.stage}, self:custom.basePath.default}
    # certificateName: '*.bagsprincess.com'
    createRoute53Record: true

  customEndpoint: "https://${self:custom.customDomain.domainName}/${self:custom.customDomain.basePath}"

  # serverless-plugin-scripts
  scripts:
    commands:
      vars: |
        echo "Stage: ${self:provider.stage}"
        echo "Name: ${self:custom.name}"
        echo "Base Endpoint: https://${self:custom.customDomain.domainName}/${self:custom.customDomain.basePath}"


# you can overwrite defaults here
#  stage: dev
#  region: us-east-1

# you can add statements to the Lambda function's IAM Role here
#  iamRoleStatements:
#    - Effect: "Allow"
#      Action:
#        - "s3:ListBucket"
#      Resource: { "Fn::Join" : ["", ["arn:aws:s3:::", { "Ref" : "ServerlessDeploymentBucket" } ] ]  }
#    - Effect: "Allow"
#      Action:
#        - "s3:PutObject"
#      Resource:
#        Fn::Join:
#          - ""
#          - - "arn:aws:s3:::"
#            - "Ref" : "ServerlessDeploymentBucket"
#            - "/*"

# you can define service wide environment variables here
#  environment:
#    variable1: value1

# packaging information here - deploy
package:
  include:
    - docs/**
  exclude:
    - bin/**
    - features/**
    - node_modules/**
    - test/**

# Functions
functions:
  about:
    handler: handler.about
    timeout: 5
    memorySize: 128
    events:
        - http:
            method: get
            path: /

  demo:
    handler: handler.demo
    events:
        - http:
            method: get
            path: /demo
            private: true

#    The following are a few example events you can configure
#    NOTE: Please make sure to change your handler code to work with those events
#    Check the event documentation for details
#    events:
#      - http:
#          path: users/create
#          method: get
#      - s3: ${env:BUCKET}
#      - schedule: rate(10 minutes)
#      - sns: greeter-topic
#      - stream: arn:aws:dynamodb:region:XXXXXX:table/foo/stream/1970-01-01T00:00:00.000
#      - alexaSkill: amzn1.ask.skill.xx-xx-xx-xx
#      - alexaSmartHome: amzn1.ask.skill.xx-xx-xx-xx
#      - iot:
#          sql: "SELECT * FROM 'some_topic'"
#      - cloudwatchEvent:
#          event:
#            source:
#              - "aws.ec2"
#            detail-type:
#              - "EC2 Instance State-change Notification"
#            detail:
#              state:
#                - pending
#      - cloudwatchLog: '/aws/lambda/hello'
#      - cognitoUserPool:
#          pool: MyUserPool
#          trigger: PreSignUp

#    Define function environment variables here
#    environment:
#      variable2: value2

# you can add CloudFormation resource templates here
resources:
#  Resources:
#    NewResource:
#      Type: AWS::S3::Bucket
#      Properties:
#        BucketName: my-new-bucket
    Outputs:
       ApiEndpoint:
          Description: API endpoint akan
          Export:
            Name: ${self:provider.stage}:${self:service}:api:endpoint
          Value: ${self:custom.customEndpoint}
